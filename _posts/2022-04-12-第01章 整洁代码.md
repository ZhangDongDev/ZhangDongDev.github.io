---
title: 第01章 整洁代码
tags: 阅读笔记 代码整洁之道
---

整洁代码的意义，以及什么是整洁代码。

<!--more-->

## 为什么要整洁代码

　　垃圾的代码会毁掉项目，毁掉自己，毁掉公司。

　　Javadoc中的`@author` 字段告诉我们，我们是代码的作者。但同时我们也是代码的读者。

　　为了写新代码，我们可能要花费10倍于写的时间来阅读旧代码。因此，为了早点下班，轻松写代码，首先要让代码易读。

## 稍后等于永不 (Later equals never)

​		赶上期限、做的快的**唯一方法**是 **始终尽可能保持代码整洁**！		

​		当我们写出烂程序的时候，总想着能跑就行，**稍后**再清理优化，但是优化**总是遥遥无期**。而混乱的代码总会拖慢我们的工期。（有个词叫**无能狂怒**，编写垃圾的代码对于整个项目毫无益处！甚至拖垮项目！要理性！）

　　同时，代码写好后会随时间流逝而腐坏。因此，**要时时刻刻保持代码整洁**。

　　“让营地比你来时更干净！”， **每天下班时代码比上班前的更干净，那么代码就不会腐坏**。这可能只是改好一个变量名，拆分一个过长的函数，消除一点点重复代码，清理一个嵌套 if 语句。这些都不需要花费很大功夫，但点滴累积，可以使代码持续保持活力。

> 编写整洁的代码，需要遵循大量的 **小技巧**。**刻苦练习** 才能获得 **代码感、整洁感**！

## 什么是整洁代码

1. **测试!** 具备单元测试、验收测试，且能通过所有测试！（没有测试的代码不干净！）
2. **不要重复代码！**（重复说明有某种想法未能得到良好表达和实现）
3. **使用有意义的命名，便于人类阅读。**（代码在字面上表达其含义，读起来令人愉悦。推崇小块的代码！）
4. **每部分的代码只做一件事！**（职责明确，力求集中；干脆利落，讲述事实。即每个函数、每个类、每个模块都全神贯注于一件事情！目的直接，不引人猜测！没有犹豫或不必要的细节！对象功能太多？那就切分为多个对象。方法功能太多？那就利用“Extract Method”重构方法，总能得到若干个合适的方法。）
5. **依赖关系尽量少，API尽量少（但要明确定义、清晰提供！），实体尽量少（比如类、方法、函数）。**
6. **时刻注重细节，精心打磨！**（完善错误处理代码、竞态处理代码，前后命名保持一致等）
7. **提早构建简单的小规模抽象。**（将功能的引用指向该抽象，在以后可以随需应变地修改其实现手段。同时，小规模提醒我们关注正在发生的事，即需求的本质，避免随意实现行为。）
8. **性能调至最优！**（首先，浪费掉的运算周期不雅观；其次，其他人可能为了优化把代码越改越乱！）

整洁的代码所能达到的效果是：几乎没有改进的余地，任何企图的改进最终都会回到原地。

（去一分则瘦，增一分则肥。）

> C++语言发明者 Bjarne Stroustrup：
>
> > 我喜欢**优雅**和**高效**的代码。**代码逻辑应当直截了当**，叫缺陷难以隐藏; 尽量**减少依赖关系**，使之便于维护; 依据某种分层战略**完善错误处理代码**; **性能调至最优**，省得引诱别人做没规矩的优化，搞出一堆混乱来。**整洁的代码只做好一件事.**
>
> 破窗理论：
>
> > 窗户破了的建筑让人觉得无人照管，**别人也不再关心**，甚至**放任或主动参加破坏**活动
>
> 《面向对象分析与设计》作者：
>
> > 整洁的代码**简单直接**，**从不隐藏设计者的意图**，充满了**干净利落**的**抽象**和**直截了当**的**控制语句**。
>
> “老大”Dave，OTI创始人，Eclipse战略教父：
>
> > 整洁的强整洁的代码应**可由作者之外的开发者阅读和增补**。它应当**有单元测试和验收测试**。它使用**有意义的命名**。它**只提供一种而非多种**做一件事的途径。它只有**尽量少的依赖关系**，而且要**明确地**定义和提供**清晰、尽量少的API**。代码应**通过其字面表达含义**，因为不同的语言导致并非所有必需信息均通过代码自身清晰表达。
>
> 《修改代码的艺术》作者：
>
> > 整洁的代码总是看起来像是某位特别**在意**他的人写的，**几乎没有改进的余地**。代码作者什么都想到了，**如果你企图改进它，总会回到原点**。
>
> 《极限编程实施》作者：
>
> > 近年来，我开始研究贝克的简单代码规则，差不多也都琢磨透了。简单代码，依其重要顺序:
> >
> > - 能通过所有测试;
> > - 没有重复代码;
> > - 体现系统中 的全部设计理念;
> > - 包括尽量少的实体，比如类、方法、函数等。
> >
> > ​      在以上诸项中，我最在意**代码重复**。如果同一段代码反复出现，就表示某种想法未在代码中得到良好的体现。我尽力去找出到底那是什么，然后再尽力更清晰地表达出来。在我看来，**有意义的命名是体现表达力的一种方式**，我往往会修改好几次才会定下名字来。借助Eclipse这样的现代编码工具，重命名代价极低,所以我无所顾忌。然而，表达力还不只体现在命名上，我也会检查对象或方法是否想做的事太多。如果对象功能太多，最好是切分为两个或多个对象。如果方法功能太多，我总是使用抽取手段(Extract Method)重构之，从而得到一个能较为清晰地说明自身功能的方法，以及另外数个说明如何实现这些功能的方法。
> >
> > ​      **消除重复**和**提高表达力**让我在整洁代码方面获益良多，只要铭记这两点，改进脏代码时就会大有不同。不过，我时常关注的另一规则就不太好解释了。
> >
> > ​      这么多年下来，我发现**所有程序都由极为相似的元素构成**。例如“在集合中查找某物”。不管是雇员记录数据库还是名值对哈希表，或者某类条目的数组，我们都会发现自己想要从集合中找到某一特定条目。一旦出现这种情况，我通常会**把实现手段封装到更<u>抽象</u>的方法或类中**。这样做好处多多。
> >
> > ​      可以先用某种简单的手段，比如哈希表来实现这一功能，由于对搜索功能的引用指向了我那个小小的抽象，就能随需应变，修改实现手段。这样就既能快速前进，又能为未来的修改预留余地。
> >
> > ​      另外，该集合抽象常常提醒我留意“真正”在发生的事，避免随意实现集合行为，因为，我真正需要的不过是某种简单的查找手段。
> >
> > ​      减少重复代码，提高表达力，提早构建简单抽象。这就是我写整洁代码的方法。
>
> Wiki发明者，所有在意代码者的教父：
>
> > 如果每个例程都让你感到**深合己意，那就是整洁代码**。如果代码让编程语言**看起来像是专为解决那个问题而存在**，就可以称之为**漂亮的代码**。





